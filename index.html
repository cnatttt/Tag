<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>2PlayerTag</title>
<style>
html,body{margin:0;height:100%;background:#0d0782;font-family:system-ui}
canvas{display:block;margin:auto;border:2px solid #ffd400}
.ui{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;
background:rgba(0,0,0,.6)}
.card{background:#0b0b2a;color:white;padding:20px 24px;border-radius:16px;
border:2px solid rgba(255,212,0,.4);width:520px}
h1{margin:0;font-size:28px}
button{margin:6px 6px 6px 0;padding:10px 14px;border-radius:10px;
border:2px solid #4ad;background:#16164a;color:white;font-weight:700;cursor:pointer}
button:hover{border-color:#ffd400}
.row{display:flex;align-items:center;gap:12px;flex-wrap:wrap}
.sliderBox{flex:1;background:#16164a;padding:10px;border-radius:10px;border:1px solid #444}
label{display:flex;justify-content:space-between;font-weight:700}
input[type=range]{width:100%}
.tip{margin-top:12px;font-size:13px;opacity:.85;border:1px solid #ffd40055;
padding:8px;border-radius:10px}
</style>
</head>

<body>
<canvas id="c" width="800" height="800"></canvas>

<div class="ui" id="menu">
  <div class="card">
    <h1>2PlayerTag</h1>
    <p><b>Dev:</b> Mcant</p>

    <div class="row">
      <button id="play">PLAY</button>
      <button id="resetScore">RESET SCORE</button>
    </div>

    <div class="row">
      <div class="sliderBox">
        <label><span>Volume</span><span id="volLabel">70%</span></label>
        <input id="vol" type="range" min="0" max="100" value="70">
      </div>

      <div class="sliderBox">
        <label><span>Power-Ups</span><span id="puLabel">ON</span></label>
        <input id="puToggle" type="range" min="0" max="1" step="1" value="1">
      </div>
    </div>

    <div class="tip" id="tip">
      Tip: Cut off lanes instead of chasing directly.
    </div>
  </div>
</div>

<script>
const c = document.getElementById("c");
const g = c.getContext("2d");
const W=c.width,H=c.height;

const menu=document.getElementById("menu");
const playBtn=document.getElementById("play");
const resetBtn=document.getElementById("resetScore");
const vol=document.getElementById("vol");
const volLabel=document.getElementById("volLabel");
const puToggle=document.getElementById("puToggle");
const puLabel=document.getElementById("puLabel");
const tip=document.getElementById("tip");

let volume=0.7;
vol.oninput=()=>{volume=vol.value/100;volLabel.textContent=Math.round(volume*100)+"%";};

let powerUpsEnabled=true;
puToggle.oninput=()=>{
  powerUpsEnabled=puToggle.value==="1";
  puLabel.textContent=powerUpsEnabled?"ON":"OFF";
};

function beep(f=440,d=.04){
 if(volume<=0)return;
 const A=window.AudioContext||window.webkitAudioContext;
 if(!beep.ctx)beep.ctx=new A();
 const o=beep.ctx.createOscillator();
 const g2=beep.ctx.createGain();
 g2.gain.value=volume*.08;
 o.frequency.value=f;o.connect(g2);g2.connect(beep.ctx.destination);
 o.start();o.stop(beep.ctx.currentTime+d);
}

// MAP
const obs=[
{x:160,y:160,w:280,h:20},{x:520,y:160,w:120,h:20},
{x:160,y:620,w:120,h:20},{x:360,y:620,w:280,h:20},
{x:160,y:160,w:20,h:220},{x:160,y:460,w:20,h:180},
{x:620,y:160,w:20,h:180},{x:620,y:460,w:20,h:180}
];

const p1={x:30,y:30,score:0};   // WASD
const p2={x:740,y:740,score:0}; // Arrows

const BASE=20,BIG=30;
const SPEED=8,TAG_SPEED=9;
const ROUND=1500;
let roundTicks=ROUND;
let count=0;
let running=false;

let keys=new Set();
window.onkeydown=e=>{
 keys.add(e.key.toLowerCase());
 if(e.key==="Escape")openMenu();
};
window.onkeyup=e=>keys.delete(e.key.toLowerCase());

const power={active:false,x:0,y:0,size:18,type:"speed",ttl:0};
let nextPower=300;

function openMenu(){running=false;menu.style.display="flex";}
function start(){running=true;menu.style.display="none";resetRound(false);}

playBtn.onclick=start;
resetBtn.onclick=()=>{p1.score=p2.score=0;beep(300,.05);};

function isP1Tagger(){return count%2===1;}
function size1(){return isP1Tagger()?BIG:BASE;}
function size2(){return isP1Tagger()?BASE:BIG;}

function collide(r){
 for(const o of obs)
  if(r.x<o.x+o.w&&r.x+r.w>o.x&&r.y<o.y+o.h&&r.y+r.h>o.y) return true;
 return false;
}

function move(p,dx,dy,s){
 let nx=p.x+dx,ny=p.y;
 if(!collide({x:nx,y:ny,w:s,h:s}))p.x=nx;
 ny=p.y+dy;
 if(!collide({x:p.x,y:ny,w:s,h:s}))p.y=ny;
 p.x=Math.max(0,Math.min(W-s,p.x));
 p.y=Math.max(0,Math.min(H-s,p.y));
}

function resetRound(swap=true){
 p1.x=30;p1.y=30;p2.x=740;p2.y=740;
 if(swap)count++;
 roundTicks=ROUND;
 power.active=false;
}

function spawnPower(){
 if(!powerUpsEnabled)return;
 power.active=true;
 power.x=Math.random()*(W-100)+50;
 power.y=Math.random()*(H-100)+50;
 power.ttl=300;
 power.type=["speed","time"][Math.random()*2|0];
 beep(900,.03);
}

function update(){
 if(!running)return;

 let p1s=isP1Tagger()?TAG_SPEED:SPEED;
 let p2s=isP1Tagger()?SPEED:TAG_SPEED;

 if(keys.has("w"))move(p1,0,-p1s,size1());
 if(keys.has("s"))move(p1,0,p1s,size1());
 if(keys.has("a"))move(p1,-p1s,0,size1());
 if(keys.has("d"))move(p1,p1s,0,size1());

 if(keys.has("arrowup"))move(p2,0,-p2s,size2());
 if(keys.has("arrowdown"))move(p2,0,p2s,size2());
 if(keys.has("arrowleft"))move(p2,-p2s,0,size2());
 if(keys.has("arrowright"))move(p2,p2s,0,size2());

 if(powerUpsEnabled){
  if(!power.active){ if(--nextPower<=0){spawnPower();nextPower=300;}}
  else if(--power.ttl<=0) power.active=false;
 }

 let r1={x:p1.x,y:p1.y,w:size1(),h:size1()};
 let r2={x:p2.x,y:p2.y,w:size2(),h:size2()};
 if(isP1Tagger())r1={x:r1.x-4,y:r1.y-4,w:r1.w+8,h:r1.h+8};
 else r2={x:r2.x-4,y:r2.y-4,w:r2.w+8,h:r2.h+8};

 if(r1.x<r2.x+r2.w&&r1.x+r1.w>r2.x&&r1.y<r2.y+r2.h&&r1.y+r1.h>r2.y){
  if(isP1Tagger())p1.score++; else p2.score++;
  resetRound(true);
 }

 if(--roundTicks<=0){
  if(isP1Tagger())p2.score++; else p1.score++;
  resetRound(true);
 }
}

function draw(){
 g.clearRect(0,0,W,H);
 g.strokeStyle="#222";
 for(let i=0;i<W;i+=40){g.beginPath();g.moveTo(i,0);g.lineTo(i,H);g.stroke();}
 for(let i=0;i<H;i+=40){g.beginPath();g.moveTo(0,i);g.lineTo(W,i);g.stroke();}

 g.fillStyle="#00b4ff";
 obs.forEach(o=>{g.fillRect(o.x,o.y,o.w,o.h);g.strokeRect(o.x,o.y,o.w,o.h);});

 if(power.active){
  g.fillStyle="#ffd400";
  g.beginPath();g.arc(power.x,power.y,9,0,Math.PI*2);g.fill();
 }

 g.fillStyle=isP1Tagger()?"red":"white";
 g.fillRect(p1.x,p1.y,size1(),size1());
 g.fillStyle=isP1Tagger()?"white":"red";
 g.fillRect(p2.x,p2.y,size2(),size2());

 g.fillStyle="white";
 g.fillText("P1: "+p1.score,14,20);
 g.fillText("TIME: "+Math.ceil(roundTicks/50),(W/2)-30,20);
 g.fillText("P2: "+p2.score,W-70,20);
}

function loop(){update();draw();requestAnimationFrame(loop);}
openMenu();loop();
</script>
</body>
</html>
