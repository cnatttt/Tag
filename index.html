<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Tag Game (8-Bit Edition)</title>

<style>
html, body { height: 100%; margin: 0; }
body {
  display: grid;
  place-items: center;
  background: #0b0b12;
  font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
  color: #fff;
}
.wrap { width: 820px; max-width: 100%; }
canvas {
  width: 800px;
  height: 800px;
  max-width: 100%;
  border: 2px solid #f6e04a;
  background: rgb(13,7,130);
  image-rendering: pixelated;
  outline: none;
}
#muteBtn {
  width: 100%;
  margin-bottom: 10px;
  padding: 10px;
  border-radius: 10px;
  border: 1px solid #3a3f52;
  background: #1f2330;
  color: white;
  cursor: pointer;
}
.hint { margin-top: 10px; opacity: 0.8; font-size: 14px; }
.hint kbd { background:#1f2330;padding:2px 6px;border-radius:6px;border:1px solid #3a3f52; }
</style>
</head>

<body>
<div class="wrap">
  <button id="muteBtn">üîä Sound: ON (click to mute)</button>
  <canvas id="game" width="800" height="800" tabindex="0"></canvas>
  <div class="hint">
    Click canvas to start sound ‚Ä¢
    P1 <kbd>W</kbd><kbd>A</kbd><kbd>S</kbd><kbd>D</kbd> |
    P2 <kbd>‚Üë</kbd><kbd>‚Üê</kbd><kbd>‚Üì</kbd><kbd>‚Üí</kbd>
  </div>
</div>

<script>
(() => {
  const canvas = document.getElementById("game");
  const ctx = canvas.getContext("2d");

  const w = 800, h = 800;
  const SPEED = 8, boxWH = 20;

  /* =======================
     üéµ 8-BIT AUDIO ENGINE
     ======================= */
  const AudioCtx = window.AudioContext || window.webkitAudioContext;
  const audioCtx = new AudioCtx();
  let muted = false;
  let musicInterval = null;

  function beep(freq, duration, type="square", vol=0.15) {
    if (muted) return;
    const o = audioCtx.createOscillator();
    const g = audioCtx.createGain();
    o.type = type;
    o.frequency.value = freq;
    g.gain.value = vol;
    o.connect(g).connect(audioCtx.destination);
    o.start();
    o.stop(audioCtx.currentTime + duration);
  }

  function tagSound() {
    beep(880, 0.08);
  }

  function timeoutSound() {
    beep(220, 0.25, "square", 0.2);
    setTimeout(() => beep(180, 0.25, "square", 0.2), 120);
  }

  function startMusic() {
    if (musicInterval) return;
    const melody = [523,659,784,659,523,659,784,880];
    let i = 0;
    musicInterval = setInterval(() => {
      if (!muted) beep(melody[i++ % melody.length], 0.12, "square", 0.08);
    }, 180);
  }

  function stopMusic() {
    clearInterval(musicInterval);
    musicInterval = null;
  }

  document.getElementById("muteBtn").onclick = () => {
    muted = !muted;
    if (muted) stopMusic();
    else startMusic();
    document.getElementById("muteBtn").textContent =
      muted ? "üîá Sound: OFF" : "üîä Sound: ON";
  };

  /* =======================
     GAME STATE
     ======================= */
  let px=0, py=0, px2=0, py2=0;
  let p1Score=0, p2Score=0;
  let count=0;
  const ROUND=1500;
  let ticks=ROUND;

  const keys={left:0,right:0,up:0,down:0,W:0,A:0,S:0,D:0};

  function reset() {
    px2=30; py2=30;
    px=w-60; py=h-60;
    ticks=ROUND;
    count++;
  }

  function move(x,y,vx,vy,size){
    x+=vx; y+=vy;
    x=Math.max(0,Math.min(w-size,x));
    y=Math.max(0,Math.min(h-size,y));
    return {x,y};
  }

  function hit(a,b){
    return a.x<b.x+b.w && a.x+a.w>b.x && a.y<b.y+b.h && a.y+a.h>b.y;
  }

  function update(){
    const tagger = count%2;
    const s1 = tagger?boxWH+10:boxWH;
    const s2 = tagger?boxWH:boxWH+10;

    let vX=0,vY=0,vX2=0,vY2=0;
    if(keys.left)vX=-SPEED;if(keys.right)vX=SPEED;
    if(keys.up)vY=-SPEED;if(keys.down)vY=SPEED;
    if(keys.A)vX2=-SPEED;if(keys.D)vX2=SPEED;
    if(keys.W)vY2=-SPEED;if(keys.S)vY2=SPEED;

    ({x:px,y:py}=move(px,py,vX,vY,s2));
    ({x:px2,y:py2}=move(px2,py2,vX2,vY2,s1));

    const h1={x:px2,y:py2,w:s1,h:s1};
    const h2={x:px,y:py,w:s2,h:s2};

    ticks--;
    if(hit(h1,h2)){
      tagSound();
      tagger?p1Score++:p2Score++;
      reset();
    } else if(ticks<=0){
      timeoutSound();
      tagger?p2Score++:p1Score++;
      reset();
    }
  }

  function draw(){
    ctx.clearRect(0,0,w,h);
    ctx.fillStyle="#ff2a2a"; ctx.fillRect(px,py,boxWH+10,boxWH+10);
    ctx.fillStyle="#fff"; ctx.fillRect(px2,py2,boxWH,boxWH);

    ctx.fillStyle="#fff";
    ctx.fillText(`P1 ${p1Score}`,10,20);
    ctx.fillText(`P2 ${p2Score}`,w-60,20);
    ctx.fillText(`TIME ${Math.ceil(ticks/50)}`,w/2-30,20);
  }

  window.addEventListener("keydown",e=>{
    audioCtx.resume(); startMusic();
    if(e.key==="ArrowLeft")keys.left=1;
    if(e.key==="ArrowRight")keys.right=1;
    if(e.key==="ArrowUp")keys.up=1;
    if(e.key==="ArrowDown")keys.down=1;
    if(e.key==="w"||e.key==="W")keys.W=1;
    if(e.key==="a"||e.key==="A")keys.A=1;
    if(e.key==="s"||e.key==="S")keys.S=1;
    if(e.key==="d"||e.key==="D")keys.D=1;
  });
  window.addEventListener("keyup",e=>{
    if(e.key==="ArrowLeft")keys.left=0;
    if(e.key==="ArrowRight")keys.right=0;
    if(e.key==="ArrowUp")keys.up=0;
    if(e.key==="ArrowDown")keys.down=0;
    if(e.key==="w"||e.key==="W")keys.W=0;
    if(e.key==="a"||e.key==="A")keys.A=0;
    if(e.key==="s"||e.key==="S")keys.S=0;
    if(e.key==="d"||e.key==="D")keys.D=0;
  });

  reset();
  setInterval(update,20);
  (function loop(){ draw(); requestAnimationFrame(loop); })();
})();
</script>
</body>
</html>
